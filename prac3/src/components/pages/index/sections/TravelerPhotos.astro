---
import { Image } from 'astro:assets';

import Section from '@/components/common/Section.astro';
import Modal from '@/components/common/Modal.astro';
import SuccessAlert from '@/components/common/SuccessAlert.astro';

import { type NavItem } from '@/constants/navItems';
import { PHOTOS } from '@/constants/travelerPhotos';

interface Props {
  navItem: NavItem;
}

const { navItem } = Astro.props;
---

<script>
  function hideAlertAfter(seconds: number) {
    setTimeout(() => (alert.style.display = 'none'), seconds * 1000);
  }

  const modal = document.getElementById(
    'photo_upload_modal'
  ) as HTMLDialogElement;
  const form = document.getElementById('photo-upload-form') as HTMLFormElement;
  const alert = document.getElementById('photo-upload-alert') as HTMLElement;

  form.addEventListener('submit', function (event) {
    event.preventDefault();

    modal.close();
    alert.style.display = 'flex';
    form.reset();

    hideAlertAfter(5);
  });
</script>

<Section id={navItem.label} title="Traveler Photos">
  <div class="flex justify-center">
    <div class="grid grid-cols-2 gap-4 sm:grid-cols-4">
      {
        PHOTOS.map(({ title, imageUrl }) => (
          <Image
            width="200"
            height="200"
            src={`${imageUrl}`}
            alt={title}
            class="h-52 w-52 rounded-2xl object-cover"
          />
        ))
      }
    </div>
  </div>

  <button onclick="photo_upload_modal.showModal()" class="btn mx-auto flex">
    Upload Photo
  </button>
  <Modal
    id="photo_upload_modal"
    title="Upload Photo"
    description="Upload the image you want to publish to traveler photos"
  >
    <form
      id="photo-upload-form"
      method="post"
      enctype="multipart/form-data"
      class="flex flex-col"
    >
      <input
        required
        type="text"
        placeholder="Photo Title"
        aria-label="Write a photo title"
        class="input input-bordered mb-5"
      />
      <input
        required
        type="file"
        accept="image/*"
        aria-label="Select photo to upload"
        class="file-input file-input-bordered mb-5"
      />
      <button type="submit" aria-label="Upload photo" class="btn">
        Upload
      </button>
    </form>
  </Modal>
  <SuccessAlert id="photo-upload-alert" class="hidden">
    Your photo has been uploaded!
  </SuccessAlert>
</Section>
